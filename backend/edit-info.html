<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" 
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" 
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" 
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <link href="/static/css/style.css" rel="stylesheet" type="text/css">
    <script src="/static/js/config.js"></script>
    <script src="/static/js/localStorage.js"></script>
    <script src="/static/js/auth.js"></script>
    <script src="/static/js/navbar.js"></script>
    <script src="/static/js/profile.js"></script>
    <script src="/static/js/set-page-info.js"></script>
    <script src="/static/js/init.js"></script>
    <script src="/static/js/getGroup.js"></script>
    <script>
      // http://jsfiddle.net/DerekL/3wRpA/
      // https://stackoverflow.com/questions/53651409/writing-a-base64-string-to-file-in-python-not-working
      // https://stackoverflow.com/questions/34116682/save-base64-image-python
      /*The FileModal Class*/
      function FileModal(accept){
        var callback = function(){};
        return {
	  show: function(){
	    $("<input>").attr({
	      type: "file",
	      accept: accept
            }).appendTo("body").hide().change(function(e){
	      var file = e.target.files[0],
	      reader = new FileReader();
	      reader.onload = function(progress){
	        callback(progress.target.result);
	      };
	    reader.readAsDataURL(file);
	    }).click();
	  },
	  set onload(c){ callback = c; }
	}
      }

      // --- --- ---

      function uploadAvatarImg(base64Img) {
        var dataJSON = {};
	dataJSON.email = getLocalStorage("email");
        dataJSON.img = base64Img;
        $.ajax({
          url: HOST_URL_EID_DAEMON + "/accounts/modify",
          type: "POST",
          async: false,
          crossDomain: true,
          data:  dataJSON,
          success: function(returnData) {
            const obj = JSON.parse(returnData);
            if (obj.result) {
              console.log("OK");
            } else {
              console.log("False");
            }
            window.location.replace("/eid.html");
          },
          error: function(xhr, ajaxOptions, thrownError){
            console.log(thrownError);
          }
        });
      }

      // --- --- ---

      function changeAvatarImg1() {
        var file = new FileModal("image/png");
        file.onload = function(d){
	  // Upload base64 image file
	  uploadAvatarImg(d);
        };
        file.show();
      }
    </script>
  </head>

  <body onload="init();">
    <div class="container-fluid border border-secondary border-width-lg min-vh-100">
      <div class="row">
        <div class="col">
          <nav class="navbar navbar-expand-sm navbar-light bg-white align-items-center px-0">
            <a class="navbar-brand mr-3" href="../index.html">
              <img class="mr-1 logo-isu" src="/static/imgs/eID-logo.png">
                <img class="logo-isu" src="/static/imgs/ISU logo-s.png">
            </a>
            <a class="navbar-brand mr-0 ml-auto d-none d-sm-block" href="#" data-toggle="dropdown" href="#" role="button" aria-expanded="false">
              <img style="width: 45px"src="/static/imgs/user-edit-solid.svg">
            </a>
            <div class="dropdown-menu dropdown-menu-right" id="dropdown">
            </div>
          </nav>
          <div class="container">
              <div class="row mt-5 align-items-center">
                <div class="col-7 pl-0">
                  <div class="form-group row">
                    <div class="col-4 pr-0">
                      <p class="mb-0">電子郵件</p>
                    </div>
                    <div class="col-8 px-0">
                      <p id="email" class="mb-0"></p>
                    </div>
                  </div>
                  <div class="form-group row align-items-center">
                    <label for="inputUserId" class="col-4 pr-0 mb-0">使用者名稱</label>
                    <div class="col-5 px-0">
                      <input id="username" type="text" class="form-control form-control-sm">
                    </div>
                    <div class="col-3 text-right">
                        <a href="#" class="btn btn-primary btn-sm" onclick="edit_username()">確認</a>
                    </div>
                  </div>
                  <div class="form-group row align-items-center">
                    <label for="inputPassword" class="col-4 pr-0 mb-0">Password</label>
                    <div class="col-5 px-0">
                      <p class="mb-0">********</p>
                    </div>
                    <div class="col-3 text-right">
                      <a href="/backend/change-pw.html" class="btn btn-primary btn-sm">編輯</a>
                    </div>
                  </div>
                  <div>
                    <a class="btn btn-light btn-block" onclick="logout()"><img src="/static/imgs/outline_logout_black_24dp.png" class="pb-1 mr-2">登出</a>
                  </div>
                </div>
                <div class="col-5">
                  <div class="card">
	            <button id="btn_avatar_img" onclick="changeAvatarImg1()"><div id="avatar_img" class="bg-contain" style="background-image: url(/static/imgs/pages/user.png); height: 170px; background-repeat: no-repeat" ></div></button>
                  </div>
                </div>
              </div>
              </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
